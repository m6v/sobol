1. Переключатель
https://github.com/Prx001/QSwitchControl/tree/main
3. Проверить работу novnc в Astra Linux

4. Проверить возможности python3-libvirt (есть в Астре)

2. При запуске программы, проверять запущена ВМ или нет. Если не запущена имитируем работу ПАК Соболь, если запущена сразу открываем ее окно! При закрытии программы можно спрашивать выключать виртуалку или нет!

3. Так как предполагается запуск нескольких экземпляролв программы, эмулятор чтения iButton нужно делать отдельным сервисом и продумать как будет выполняться взаимодействие!

2. Понять как в Linux можно перехватывать события выключения и перезагрузки и реализовать отправку по сети сигнала на хост для того, чтобы можно было закрыть или перейти на стартовую страницу программы эмулятора ПАК "Соболь".

Чтобы выполнить команду перед перезагрузкой в Linux с помощью Systemd, создайте специальный юнит-файл типа .service или используйте уже существующий, определив в нем директивы ExecStop (для остановки) и ExecStartPre (для запуска перед стартом сервиса) или ExecStartPost (для запуска после старта сервиса). Для выполнения команды только перед самой перезагрузкой системы, можно использовать скрипт-сервис, который срабатывает последним, перед полной остановкой системы. 
Создание юнит-файла сервиса для команды перед перезагрузкой
Создайте файл сервиса:
Создайте новый файл в каталоге /etc/systemd/system/ с расширением .service, например my-shutdown-command.service.
Определите директивы:
Внутри файла добавьте следующие директивы:

```
[Unit]
Description=Выполнить команду перед перезагрузкой
DefaultDependencies=no # Важно для корректной работы в конце цикла перезагрузки

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/путь/к/вашей/команде --аргументы # Ваша команда для выполнения
ExecStop=/bin/systemctl stop my-service.service # Пример остановки другого сервиса
ExecStartPre=/path/to/your/pre-shutdown-script.sh # Скрипт, выполняемый перед стартом сервиса
ExecStartPost=/bin/systemctl start my-service.service # Пример запуска другого сервиса
# Важно, чтобы этот сервис запускался последним
# Для этого добавьте директиву After в блок [Unit]
After=systemd-shutdown.target

[Install]
WantedBy=multi-user.target
```

- Description: Описание вашего сервиса;
- DefaultDependencies=no: Отключение зависимостей для корректной работы в конце цикла перезагрузки системы;
- Type=oneshot: Сервис выполняет команду и завершает работу;
- RemainAfterExit=yes: Сохраняет состояние сервиса активным после завершения выполнения команды ExecStart;
- ExecStart: Команда, которую необходимо выполнить перед перезагрузкой;
- After: Указывает на то, что данный сервис должен запускаться после указанных юнитов (в данном случае, systemd-shutdown.target обеспечивает выполнение сервиса перед завершением работы системы);
- WantedBy: Описывает, как сервис устанавливается в системе.

Перезагрузите конфигурацию Systemd:
После создания или изменения файла сервиса, выполните следующую команду для перезагрузки конфигурации:

```
sudo systemctl daemon-reload
```

Включите и запустите сервис:
Включите сервис для автоматического запуска при загрузке системы и запустите его вручную:

```
sudo systemctl enable my-shutdown-command.service
sudo systemctl start my-shutdown-command.service
```
 
Теперь команда из `ExecStart` вашего сервиса будет выполняться перед перезагрузкой системы. 

4. При получении сигнала о перезагрузке переходить в интерфейсе на первое окно или закрывать программу (конкретное действие задавать в файле настроек)
5. При нажатии кнопки [Загрузка ОС] запускать виртуальную машину (предварительно проверив, что она не запушена)
virsh start arm-abi # если уже запущена, то выдаст ошибку "error: Domain is already active"
Domain 'arm-abi' started

Получить статус ВМ
virsh dominfo arm-abi | grep State:
State:          shut off
или проверить наличие ВМ в списке выключенных
virsh list --inactive | grep " arm-abi " # пробелы, чтобы не находить подстроку, например, arm-abi2
 -    arm-abi   shut off
echo $? # 0 - если машина есть в списке выключенных


Подключение к Libvirt:
import libvirt

conn = libvirt.open(None) # Открывает соединение с локальным гипервизором
if conn is None:
    print('Не удалось подключиться к Libvirt')
else:
    print('Подключение к Libvirt успешно')

Получение списка ВМ:
vms = conn.listAllDomains() # Получает список всех ВМ
for vm in vms:
    print(f"Имя ВМ: {vm.name()}, Статус: {vm.state()}")

Запуск/остановка ВМ:
vm_name = "имя_вашей_вм"
try:
    vm = conn.lookupByName(vm_name)
    if vm.state() != libvirt.VIR_DOMAIN_RUNNING:
        vm.create() # Запуск
        print(f"ВМ '{vm_name}' запущена")
    else:
        vm.destroy() # Остановка
        print(f"ВМ '{vm_name}' остановлена")
except libvirt.libvirtError as e:
    print(f"Ошибка: {e}")


Закрытие соединения:
conn.close()
